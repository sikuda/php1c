<?php
use php1C;
use function php1C\toString1C;
use function php1C\makeCode;

require_once('src/php1C__code.php');

$code = 'Н = 5000;
         Массив = Новый Массив();

         Массив.Вставить(0, Ложь);
         Массив.Вставить(1, Ложь);

         Для индекс = 2 По Н Цикл
             Массив.Вставить(индекс, Истина);
         КонецЦикла;

         времяНачала = ТекущаяУниверсальнаяДатаВМиллисекундах();
         индекс = 2;
         ПОКА индекс <= Н Цикл
             Если Массив[индекс] Тогда
                 квадрат = индекс * индекс;
                 Если квадрат <= Н Тогда
                     м = квадрат;
                     Пока м <= Н Цикл
                         Массив[м] = Ложь;
                         м = м + индекс;
                     КонецЦикла;
                 КонецЕсли;
             КонецЕсли;
             индекс = индекс + 1;
         КонецЦикла;

         времяОкончания = ТекущаяУниверсальнаяДатаВМиллисекундах();
         Результат = времяОкончания - времяНачала;';
//$str = makeCode($code, "Результат");
//echo toString1C($str);

$n = 5000;
$array = array();
$array[0] = false;
$array[1] = false;
for($i = 2; $i <= $n; $i++){
    $array[$i] = true;
}

$timeBegin = hrtime(true)/1e+6;;
$i = 2;
while ( $i <= $n ) {
    if( $array[$i] === true) {
        $sq = $i * $i;
        if($sq <= $n) {
            $m = $sq;
            while ($m <= $n) {
                $array[$m] = false;
                $m += $i;
            }
        }
    }
    $i += 1;
}

$timeEnd = hrtime(true)/1e+6;;
$diff = $timeEnd - $timeBegin;
echo $diff;

$N=php1C\Number1C("5000");
$МАССИВ=php1C\Array1C(array());

$МАССИВ->Add(false);$МАССИВ->Add(false);
for($INDEKS=php1C\Number1C("2") ;$INDEKS<=$N;$INDEKS=$INDEKS->add(1)){
    $МАССИВ->Add(true);
}
$VREMYANACHALA=php1C\CurrentUniversalDateMilliseconds();
for($INDEKS=php1C\Number1C("2") ;$INDEKS<=$N;$INDEKS=$INDEKS->add(1)){
    if($МАССИВ->GET($INDEKS) ){
        $KVADRAT=php1C\mul1C($INDEKS,$INDEKS);
        if(php1C\less_equal1C($KVADRAT,$N)){
            $M=$KVADRAT;
            while(php1C\less_equal1C($M,$N)){
                $МАССИВ->SET($M, false);
                $M=php1C\add1C($M,$INDEKS);
            }
        }
    }
}
$VREMYAOKONCHANIYA=php1C\CurrentUniversalDateMilliseconds();
$REZULTAT=php1C\sub1C($VREMYAOKONCHANIYA,$VREMYANACHALA);
echo '<--------->';
echo $REZULTAT;

//---------------------------------------------------------------------

$N=5000;
$МАССИВ=php1C\Array1C(array());

$МАССИВ->Add(false);$МАССИВ->Add(false);
for($INDEKS=2 ;$INDEKS<=$N;$INDEKS=$INDEKS+1){
    $МАССИВ->Add(true);
}
$VREMYANACHALA=php1C\CurrentUniversalDateMilliseconds();
for($INDEKS=2 ;$INDEKS<=$N;$INDEKS=$INDEKS+1){
    if($МАССИВ->GET($INDEKS) ){
        $KVADRAT=$INDEKS*$INDEKS;
        if($KVADRAT <= $N){
            $M=$KVADRAT;
            while($M < $N){
                $МАССИВ->SET($M, false);
                $M=$M + $INDEKS;
            }
        }
    }
}
$VREMYAOKONCHANIYA=php1C\CurrentUniversalDateMilliseconds();
$REZULTAT=php1C\sub1C($VREMYAOKONCHANIYA,$VREMYANACHALA);
echo '<--------->';
echo $REZULTAT;

